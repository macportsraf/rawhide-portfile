# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           legacysupport 1.0
PortGroup           makefile 1.0

name                rawhide
version             3.2
revision            0

categories          sysutils
license             GPL-3+
maintainers         {raf.org:raf @macportsraf} openmaintainer
description         (rh) find files using pretty C expressions
long_description    {*}${description}. \
                    \n\nRawhide (rh) lets you search for files on the command line using \
                    expressions and user-defined functions in a mini-language inspired by C. \
                    It's like find(1), but more fun to use. Search criteria can be very \
                    readable and self-explanatory and/or very concise and typeable, and you can \
                    create your own lexicon of search terms. The output can include lots of \
                    detail, like ls(1).
depends_lib         port:pcre2 port:libmagic

homepage            https://raf.org/rawhide/
master_sites        ${homepage}download/ \
                    https://web.archive.org/web/20230609112737/${homepage}download/ \
                    https://github.com/raforg/${name}/releases/download/v${version}/ \
                    https://codeberg.org/raforg/${name}/releases/download/v${version}/
checksums           rmd160 685df5c44c4b6ef7ba27817fc1ea92949f81d388 \
                    sha256 73d0f755ec3edb07c714255a4fb2a47b52b6225815fc39c5719b8330f94530ce \
                    size 283346

# Place env $(CFLAGS) after local cflags (so -Os overrides -O3)
patchfiles          macports.patch

# Note: Not a GNU autoconf configure script
use_configure       yes
configure.args      --macports --prefix=${prefix}
build.target        rh
# Need openat, fdopendir, fstatat, faccessat, unlinkat, readlinkat.
# POSIX 2008, but they didn't make it into macOS until later.
# But note: This compiles, but doesn't work, on macos-10.6.8. :-(
legacysupport.newest_darwin_requires_legacy 13

test.run            yes
test.env-append     quiet=1

livecheck.type      regex
livecheck.url       ${homepage}download/
livecheck.regex     ${name}-(\\d+(?:\\.\\d+)*)${extract.suffix}

